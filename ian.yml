---
- hosts: all
  gather_facts: false
  tasks:
#
#   copy the powershell file to C:\TEMP\ on the server
#
#
  - name: run PS_Script AUTOSERVICES.PS1
    ansible.windows.win_shell: C:\temp\PS_Scripts\AutoServices.ps1

  - name: pause tasks for 5 seconds to allow the script to run
    ansible.builtin.pause:
      seconds: 5
      prompt: Waiting for script to run, please wait!

  - name: Get number of services to restart
    ansible.windows.win_command: powershell.exe -
    args:
      stdin: (Get-Content C:\temp\autoservices.txt).Length
    register: restart_number
    
#  - name:
#    set_fact: req_num4={{ restart_number.stdout_lines[0] }}

  - name: powershell add 1 to total
    win_shell: "{{ restart_number.stdout_lines[0] }} + 1"
    register: req_num5

  - name: set_fact
    set_fact: req_num6={{ req_num5.stdout_lines[0]|int}}

  - name: debug
    ansible.builtin.debug:
      msg: "do it {{ req_num6 }} times"

#  - name: do a loop
#    include_tasks: tasks1c.yml
#    loop: "{{ range(1,(req_num6|int)) | list }}"
