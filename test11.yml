---
  - name: read c:\temp\autoservices.txt to get the service to restart
    win_shell:
      Select-String -Path C:\temp\autoservices.txt -pattern "Service="
    register: service

  - name: set the fact for the service
    set_fact: service={{ service.stdout_lines[item] }}

  - name: remove everything apart from service name
    set_fact: service_name={{ service | regex_replace('.*=') | regex_replace ("'.*") }}

  - name: debug1
    debug:
      msg: "I have a name"
    when: service_name != None

  - name: debug2
    debug:
      msg: "I am nothing"
    when: service_name == None

  - name: debug3
    debug:
      msg: "I am also nothing"
    when: service_name == ""
  # service.stdout == ""

  - name: debug4
    debug:
      msg: "I may have a name"
    when: service_name != " "

  - name: restart the Auto service
    block:
      - name: restart the {{ service_name }} service
        win_service:
          name: "{{ service_name }}"
          state: started
        register: result

      - name: Check Service Status
        debug:
          msg: "Service {{ service_name }} has now started"
        when: result.state == "running"

      - name: Check Service Status
        debug:
          msg: "Service {{ service_name }} has now started"
        when: result.state != "running"
